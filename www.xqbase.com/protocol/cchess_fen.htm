<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=gb_2312-80">
<meta name="GENERATOR" content="Microsoft FrontPage Express 2.0">
<title>中国象棋电脑应用规范(三)：FEN文件格式</title>
</head>

<body background="../background.gif">

<dl>
    <div align="center"><center>
    <dt>中国象棋电脑应用规范(三)</dt>
    </center></div><div align="center"><center>
    <dt>　</dt>
    </center></div><div align="center"><center>
    <dt><font size="6" face="Arial"><strong>FEN</strong></font><font
        size="6" face="隶书">文件格式</font></dt>
    </center></div><div align="center"><center>
    <dt>　</dt>
    </center></div><div align="center"><center>
    <dt>象棋百科全书网 <font face="Times New Roman">(</font><a
        href="mailto:webmaster@xqbase.com"><font
        face="Times New Roman">webmaster@xqbase.com</font></a><font
        face="Times New Roman">)</font></dt>
    </center></div><div align="center"><center>
    <dt><font face="Times New Roman">2004</font>年<font
        face="Times New Roman">11</font>月初稿，<font
        face="Times New Roman">2006</font>年<font
        face="Times New Roman">2</font>月修订</dt>
    </center></div>
    <dt>　</dt>
    <dt><font size="5" face="楷体_GB2312"><strong>一、</strong></font><font
        size="5" face="Arial"><strong>FEN</strong></font><font
        size="5" face="楷体_GB2312"><strong>的优势</strong></font></dt>
    <dt>　</dt>
    <dt>　　<font face="Times New Roman">FEN(Forsyth-Edwards
        Notation)</font>是专门用来表示象棋局面的记录规范，在这个规范下，一个局面可以简单地用一行“<font
        face="Times New Roman">FEN</font>格式串”来表示，而不必烦琐地说：“红帅在四路次底线，黑将在５路底线……”。由于它是文本格式的<font
        face="Times New Roman">(</font>只牵涉到很有限的几个字母、数字和符号<font
        face="Times New Roman">)</font>，因此网上传递棋局就非常方便，不用把棋图画在纸上或用文字笨拙地描述了，而是用棋谱编辑软件摆好局面，自动得到<font
        face="Times New Roman">FEN</font>格式串，再贴到诸如<font
        face="Times New Roman">Web</font>网页、<font
        face="Times New Roman">BBS</font>、电子论坛等能够传递文字的网络应用平台上。读者面对<font
        face="Times New Roman">FEN</font>格式传，只要借助于棋谱编辑软件，用“赋值”和“粘贴”就可以完全重现局面，使得棋谱交流快速而高效。</dt>
    <dt>　</dt>
    <dt><font size="5" face="楷体_GB2312"><strong>二、</strong></font><font
        size="5" face="Arial"><strong>FEN</strong></font><font
        size="5" face="楷体_GB2312"><strong>格式串</strong></font></dt>
    <dt>　</dt>
    <dt>　　国际象棋的<font face="Times New Roman">FEN</font>格式串是由<font
        face="Times New Roman">6</font>段<font
        face="Times New Roman">ASCII</font>字符串组成的代码<font
        face="Times New Roman">(</font>彼此<font
        face="Times New Roman">5</font>个空格隔开<font
        face="Times New Roman">)</font>，这<font
        face="Times New Roman">6</font>段代码的意义依次是：</dt>
    <dt>　　<font face="Times New Roman">(1) </font>棋盘上的棋子，这是<font
        face="Times New Roman">FEN</font>格式串的主要部分；</dt>
    <dt>　　<font face="Times New Roman">(2) </font>轮到哪一方走子；</dt>
    <dt>　　<font face="Times New Roman">(3) </font>每方及该方的王翼和后翼是否还存在“王车易位”的可能；</dt>
    <dt>　　<font face="Times New Roman">(4) </font>是否存在吃过路兵的可能，过路兵是经过哪个格子的；</dt>
    <dt>　　<font face="Times New Roman">(5) </font>最近一次吃子或者进兵后棋局进行的步数<font
        face="Times New Roman">(</font>半回合数<font
        face="Times New Roman">)</font>，用来判断“<font
        face="Times New Roman">50</font>回合自然限着”；</dt>
    <dt>　　<font face="Times New Roman">(6) </font>棋局的回合数。</dt>
    <dt><font size="3">　　中国象棋没有</font>“王车易位”和“吃过路兵”的着法，所以<font
        face="Times New Roman">FEN</font>格式串的这两项空缺，以最初局面为例说明：</dt>
    <dd>　</dd>
    <dd><font color="#FF0000">rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR
        </font><font color="#008000">w </font><font
        color="#800080">- </font><font color="#FF00FF">- </font><font
        color="#0000FF">0 </font><font color="#800000">1</font></dd>
    <dt>　</dt>
    <dt>　　<font face="Times New Roman">(1)</font><font
        color="#FF0000" face="Times New Roman"> </font><font
        color="#FF0000">红色区域</font>，表示棋盘布局，小写表示黑方，大写表示红方，其他规则同国际象棋的<font
        face="Times New Roman">FEN</font>规范<font
        face="Times New Roman">(</font>请参阅《<a
        href="http://www.chessit.net/" target="_blank">国际象棋译文苑</a>》文摘――<a
        href="pgnfen2.htm" target="_blank">关于<font
        face="Times New Roman">PGN</font>和<font
        face="Times New Roman">FEN</font>记谱规范<font
        face="Times New Roman">(</font>下<font
        face="Times New Roman">)</font></a>一文<font
        face="Times New Roman">)</font>。这里要注意两点，一是中国象棋棋盘有<font
        face="Times New Roman">10</font>行，所以要用<font
        face="Times New Roman">9</font>个“<font
        face="Times New Roman">/</font>”把每一行隔开；二是棋子名称用英文字母表示，国际象棋中没有的棋子是仕<font
        face="Times New Roman">(</font>士<font
        face="Times New Roman">)</font>和炮，这里分别用字母<font
        face="Times New Roman">A(a)</font>和<font
        face="Times New Roman">C(c)</font>表示。</dt>
    <dt>　　<font face="Times New Roman">(2) </font><font
        color="#008000">绿色区域</font>，表示轮到哪一方走子，“<font
        face="Times New Roman">w</font>”表示红方，“<font
        face="Times New Roman">b</font>”表示黑方。<font
        face="Times New Roman">(</font>有人认为红方应该用“<font
        face="Times New Roman">r</font>”表示，很多象棋软件确实是这样表示的。<font
        face="Times New Roman">ElephantBoard</font>尽管用“<font
        face="Times New Roman">w</font>”表示，但识别时采取灵活的办法，即“<font
        face="Times New Roman">b</font>”表示黑方，除此以外都表示红方。<font
        face="Times New Roman">)</font></dt>
    <dt>　　<font face="Times New Roman">(3) </font><font
        color="#800080">深紫色区域</font>，空缺，始终用“<font
        face="Times New Roman">-</font>”表示。</dt>
    <dt>　　<font face="Times New Roman">(4) </font><font
        color="#FF0080">紫红色区域</font>，空缺，始终用“<font
        face="Times New Roman">-</font>”表示。</dt>
    <dt>　　<font face="Times New Roman">(5) </font><font
        color="#0000FF">蓝色区域</font>，表示双方没有吃子的走棋步数<font
        face="Times New Roman">(</font>半回合数<font
        face="Times New Roman">)</font>，通常该值达到<font
        face="Times New Roman">120</font>就要判和<font
        face="Times New Roman">(</font>六十回合自然限着<font
        face="Times New Roman">)</font>，一旦形成局面的上一步是吃子，这里就标记“<font
        face="Times New Roman">0</font>”。<font
        face="Times New Roman">(</font>这个参数对于普通局面的意义不大，<font
        face="Times New Roman">ElephantBoard</font>的规则处理器并不是根据这一项来判断和棋的，所以总是计为“<font
        face="Times New Roman">0</font>”。<font
        face="Times New Roman">)</font></dt>
    <dt>　　<font face="Times New Roman">(6) </font><font
        color="#800000">棕色区域</font>，表示当前的回合数，在研究中局或排局时，作为研究对象的局面，这一项可以写<font
        face="Times New Roman">1</font>，随着局势的发展逐渐增加。</dt>
    <dt>　</dt>
    <dt><font size="5" face="楷体_GB2312"><strong>三、</strong></font><font
        size="5" face="Arial"><strong>FEN</strong></font><font
        size="5" face="楷体_GB2312"><strong>文件</strong></font></dt>
    <dt>　</dt>
    <dt>　　<font face="Times New Roman">FEN</font>格式串有很多载体，通常的做法是把它保存成后缀为“<font
        face="Times New Roman">.FEN</font>”的文件。<font
        face="Times New Roman">FEN</font>文件是<font
        face="Times New Roman">ASCII</font>码文件，可以用任何文本编辑软件来建立和修改，也可以通过象棋棋谱软件来产生。</dt>
    <dt>　</dt>
    <dt><font size="5" face="楷体_GB2312"><strong>四、历史局面的表示</strong></font></dt>
    <dt>　</dt>
</dl>

<table border="0">
    <tr>
        <td><dl>
            <dt>　　这是只在“<a href="cchess_ucci.htm"
                target="_blank">中国象棋通用引擎协议</a>”<font
                face="Times New Roman">(UCCI</font>协议<font
                face="Times New Roman">)</font>中采用的方法，用来表示历史局面。在<font
                face="Times New Roman">UCCI</font>协议中，局面用<font
                face="Times New Roman">position fen &lt;fen_string&gt;</font>来传递，由于<font
                face="Times New Roman">FEN</font>格式串无法记录历史局面，所以该指令后面必须用<font
                face="Times New Roman">moves</font>选项来说明。例如右图局面，发生时，界面向引擎传递局面信息：</dt>
            <dd>position fen 9/9/3k5/9/9/9/4R4/3A5/8r/4K4 b - - 0
                1</dd>
            <dt>　　此时引擎走车９进１是没有问题的。然而当它是某个长将局面的延续时，界面向引擎传递的局面信息就必须用<font
                face="Times New Roman">moves</font>选项来说明：</dt>
            <dd>position fen 9/9/3k5/9/9/9/4R4/3A5/4K4/8r b - - 0
                1 moves i0i1 e1e0 i1i0 e0e1 i0i1 e1e0 i1i0 e0e1 i0i1
                e1e0</dd>
            <dt>　　尽管也是右图的局面，但意义已经发生了变化，此时引擎不可能再走车９进１，因为紧接着一步帅五进一，导致局面重复第三次，黑方被判长将作负。</dt>
        </dl>
        </td>
        <td><img src="cchess_fen.gif" width="210" height="234"></td>
    </tr>
</table>

<p>　　<font face="Times New Roman">ElephantBoard</font>向引擎传递局面时，<font
face="Times New Roman">&lt;fen_string&gt;</font>总是最近一次吃过子的局面<font
face="Times New Roman">(</font>或开始局面<font
face="Times New Roman">)</font>，后面所有的着法都用<font
face="Times New Roman">moves</font>选项来传递给引擎，这样就包含了判断自然限着和长打的历史信息，这些信息可由引擎来处理。</p>

<dir>
    <li>上一篇　<a href="cchess_move.htm">中国象棋电脑应用规范<font
        face="Times New Roman">(</font>二<font
        face="Times New Roman">)</font>：着法表示</a></li>
    <li>下一篇　<a href="cchess_pgn.htm">中国象棋电脑应用规范<font
        face="Times New Roman">(</font>四<font
        face="Times New Roman">)</font>：<font
        face="Times New Roman">PGN</font>文件格式</a> </li>
    <li>返　回　<a href="../protocol.htm">象棋百科全书――规则与协议</a>
    </li>
</dir>
<div align="center"><center>

<table border="0">
    <tr>
        <td><p align="center"><a
        href="http://www.xqbase.com/" target="_blank"><img
        src="../xqbase.gif" border="0" width="88"
        height="31"></a></p>
        </td>
    </tr>
    <tr>
        <td><a href="http://www.xqbase.com/"
        target="_blank"><font size="2" face="Arial"><strong>www.xqbase.com</strong></font></a></td>
    </tr>
</table>
</center></div>
</body>
</html>
